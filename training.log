[2025-12-11 15:00:17] [INFO] [training] [Main]: === HUẤN LUYỆN MÔ HÌNH ===
[2025-12-11 15:00:17] [INFO] [training] [ConfigManager]: >>> KHỞI TẠO CONFIG MANAGER <<<
[2025-12-11 15:00:17] [WARNING] [training] [ConfigManager]: Config 'config.yaml' chưa tồn tại. Đang tạo cấu hình tối ưu mặc định...
[2025-12-11 15:00:17] [INFO] [training] [ConfigManager]: Đã lưu cấu hình vào 'config.yaml'
[2025-12-11 15:00:17] [INFO] [training] [ConfigManager]: Đã ghi đè cấu hình từ dòng lệnh nếu có.
[2025-12-11 15:00:17] [INFO] [training] [Main]: >>> THIẾT LẬP <<<
[2025-12-11 15:00:17] [DEBUG] [training] [Main]: 
[CHECK] Target Mode:    LOG_RETURN
[2025-12-11 15:00:17] [DEBUG] [training] [Main]: [CHECK] Active Models:  ['xgboost', 'catboost', 'lightgbm', 'random_forest']
[2025-12-11 15:00:17] [DEBUG] [training] [Main]: [CHECK] Tuning Trials:  50
[2025-12-11 15:00:17] [INFO] [training] [ConfigManager]: Đã lưu cấu hình vào 'config.yaml'
[2025-12-11 15:00:17] [INFO] [training] [Main]: 'config.yaml'
[2025-12-11 15:00:17] [INFO] [training] [DataModule]: >>> KHỞI TẠO DATA MODULE <<<
[2025-12-11 15:00:17] [INFO] [training] [DataModule]: --- THỰC HIỆN DATA PIPELINE ---
[2025-12-11 15:00:17] [INFO] [training] [DataModule]: *** ĐỌC DỮ LIỆU ***
[2025-12-11 15:00:17] [INFO] [training] [DataModule]: *** TẠO ĐẶC TRƯNG ***
[2025-12-11 15:00:17] [INFO] [training] [DataModule]: *** CHUẨN BỊ X, y ***
[2025-12-11 15:00:17] [INFO] [training] [DataModule]: *** LỰA CHỌN ĐẶC TRƯNG ***
[2025-12-11 15:00:17] [INFO] [training] [DataModule]: Hoàn thành. X: (1695, 30), y: (1695,)
[2025-12-11 15:00:17] [INFO] [training] [DataModule]: --- THỰC HIỆN DATA PIPELINE ---
[2025-12-11 15:00:17] [INFO] [training] [DataModule]: *** ĐỌC DỮ LIỆU ***
[2025-12-11 15:00:17] [INFO] [training] [DataModule]: *** TẠO ĐẶC TRƯNG ***
[2025-12-11 15:00:17] [INFO] [training] [DataModule]: *** CHUẨN BỊ X, y ***
[2025-12-11 15:00:17] [INFO] [training] [DataModule]: *** LỰA CHỌN ĐẶC TRƯNG ***
[2025-12-11 15:00:18] [INFO] [training] [DataModule]: Hoàn thành. X: (1695, 30), y: (1695,)
[2025-12-11 15:00:18] [DEBUG] [training] [Main]: 
Kiểm tra dữ liệu đầu ra:
[2025-12-11 15:00:18] [DEBUG] [training] [Main]: 1. Kích thước X: (1695, 30)
[2025-12-11 15:00:18] [DEBUG] [training] [Main]: 2. Kích thước y: (1695,)
[2025-12-11 15:00:18] [DEBUG] [training] [Main]: 3. Dải giá trị y (Return): Min=-0.0919, Max=0.0720
[2025-12-11 15:00:18] [DEBUG] [training] [Main]: 4. Raw Price cuối cùng: 121.25
[2025-12-11 15:00:18] [DEBUG] [training] [Main]:             USO_Open  GDX_Volume     SP_open  ...    SP_volume  EG_volume  EU_Trend
Date                                          ...                                  
2018-12-26      9.25  76365200.0  235.970001  ...  218485408.0   746300.0       0.0
2018-12-27      9.59  52393000.0  242.570007  ...  186267296.0   744000.0       1.0
2018-12-28      9.54  49835000.0  249.580002  ...  153100192.0  1061100.0       1.0

[3 rows x 30 columns]
[2025-12-11 15:00:18] [DEBUG] [training] [Main]: Features: 30 columns
[2025-12-11 15:00:18] [DEBUG] [training] [Main]: Total Samples: 1695
[2025-12-11 15:00:18] [INFO] [training] [DataModule]: --- THỰC HIỆN DATA PIPELINE ---
[2025-12-11 15:00:18] [INFO] [training] [DataModule]: *** ĐỌC DỮ LIỆU ***
[2025-12-11 15:00:18] [INFO] [training] [DataModule]: *** TẠO ĐẶC TRƯNG ***
[2025-12-11 15:00:18] [INFO] [training] [DataModule]: *** CHUẨN BỊ X, y ***
[2025-12-11 15:00:18] [INFO] [training] [DataModule]: *** LỰA CHỌN ĐẶC TRƯNG ***
[2025-12-11 15:00:19] [INFO] [training] [DataModule]: Hoàn thành. X: (1695, 30), y: (1695,)
[2025-12-11 15:00:19] [INFO] [training] [TimeSeriesSplitter]: >>> KHỞI TẠO TIME SERIES SPLITTER <<<
[2025-12-11 15:00:19] [INFO] [training] [VisualizationModule]: >>> KHỞI TẠO VISUALIZATION MODULE <<<
[2025-12-11 15:00:19] [INFO] [training] [Main]: Đang vẽ sơ đồ chia dữ liệu...
[2025-12-11 15:00:19] [INFO] [training] [TimeSeriesSplitter]: *** TẠO CÁC FOLD CHIA DỮ LIỆU ***
[2025-12-11 15:00:19] [INFO] [training] [TimeSeriesSplitter]: Đã tạo 11 folds (Train Window: 1000, Test Window: 60, Purge: 0)
[2025-12-11 15:00:19] [INFO] [training] [VisualizationModule]: Vẽ sơ đồ chia dữ liệu Train/Test/Purge...
[2025-12-11 15:00:27] [INFO] [training] [VisualizationModule]: Đã hoàn thành vẽ sơ đồ chia dữ liệu.
[2025-12-11 15:00:27] [INFO] [training] [TimeSeriesSplitter]: *** TẠO CÁC FOLD CHIA DỮ LIỆU ***
[2025-12-11 15:00:27] [INFO] [training] [TimeSeriesSplitter]: Đã tạo 11 folds (Train Window: 1000, Test Window: 60, Purge: 0)
[2025-12-11 15:00:27] [INFO] [training] [TimeSeriesSplitter]: *** KẾT QUẢ CHIA DỮ LIỆU (CV Fold) ***
[2025-12-11 15:00:27] [DEBUG] [training] [TimeSeriesSplitter]: Train Period: 2014-08-04 -> 2018-08-09 (1000 mẫu)
[2025-12-11 15:00:27] [INFO] [training] [TimeSeriesSplitter]: Test Period : 2018-08-10 -> 2018-11-06 (60 mẫu)
[2025-12-11 15:00:27] [DEBUG] [training] [Main]: 
Check shape final split:
[2025-12-11 15:00:27] [DEBUG] [training] [Main]: X_train: (1000, 30), y_train: (1000,)
[2025-12-11 15:00:27] [DEBUG] [training] [Main]: X_test:  (60, 30),  y_test:  (60,)
[2025-12-11 15:00:27] [INFO] [training] [Main]: === HYPERPARAMETER TUNING ===
[2025-12-11 15:00:27] [INFO] [training] [TimeSeriesSplitter]: *** TẠO CÁC FOLD CHIA DỮ LIỆU ***
[2025-12-11 15:00:27] [INFO] [training] [TimeSeriesSplitter]: Đã tạo 11 folds (Train Window: 1000, Test Window: 60, Purge: 0)
[2025-12-11 15:00:27] [INFO] [training] [HyperParameterOptimizer]: >>> KHỞI TẠO HYPERPARAMETER OPTIMIZER <<<
[2025-12-11 15:00:27] [INFO] [training] [HyperParameterOptimizer]: *** TỐI ƯU SIÊU THAM SỐ CHO CÁC MÔ HÌNH ***
[2025-12-11 15:00:27] [INFO] [training] [HyperParameterOptimizer]: Bắt đầu tối ưu tham số cho xgboost...
[2025-12-11 15:04:50] [DEBUG] [training] [HyperParameterOptimizer]: Best xgboost: RMSE=0.00599
[2025-12-11 15:04:50] [INFO] [training] [HyperParameterOptimizer]: Bắt đầu tối ưu tham số cho catboost...
[2025-12-11 15:08:15] [DEBUG] [training] [HyperParameterOptimizer]: Best catboost: RMSE=0.00590
[2025-12-11 15:08:15] [INFO] [training] [HyperParameterOptimizer]: Bắt đầu tối ưu tham số cho lightgbm...
[2025-12-11 15:09:12] [DEBUG] [training] [HyperParameterOptimizer]: Best lightgbm: RMSE=0.00603
[2025-12-11 15:09:12] [INFO] [training] [HyperParameterOptimizer]: Bắt đầu tối ưu tham số cho random_forest...
[2025-12-11 15:15:24] [DEBUG] [training] [HyperParameterOptimizer]: Best random_forest: RMSE=0.00601
[2025-12-11 15:15:24] [INFO] [training] [HyperParameterOptimizer]: Đã lưu tham số tối ưu vào: results\best_hyperparameters.json.
[2025-12-11 15:15:24] [INFO] [training] [Main]: 
Tham số tối ưu đã được lưu file JSON.
[2025-12-11 15:15:24] [INFO] [training] [ModelTrainer]: Đã nạp tham số tối ưu từ JSON.
[2025-12-11 15:15:25] [INFO] [training] [ModelTrainer]: >>> KHỞI TẠO MODEL TRAINER <<<
[2025-12-11 15:15:25] [INFO] [training] [TimeSeriesSplitter]: *** TẠO CÁC FOLD CHIA DỮ LIỆU ***
[2025-12-11 15:15:25] [INFO] [training] [TimeSeriesSplitter]: Đã tạo 11 folds (Train Window: 1000, Test Window: 60, Purge: 0)
[2025-12-11 15:15:25] [INFO] [training] [TimeSeriesSplitter]: *** KẾT QUẢ CHIA DỮ LIỆU (CV Fold) ***
[2025-12-11 15:15:25] [DEBUG] [training] [TimeSeriesSplitter]: Train Period: 2014-08-04 -> 2018-08-09 (1000 mẫu)
[2025-12-11 15:15:25] [INFO] [training] [TimeSeriesSplitter]: Test Period : 2018-08-10 -> 2018-11-06 (60 mẫu)
[2025-12-11 15:15:25] [INFO] [training] [ModelTrainer]: *** BẮT ĐẦU TRAINING MÔ HÌNH CUỐI CÙNG ***
[2025-12-11 15:15:25] [INFO] [training] [ModelTrainer]: Đang huấn luyện xgboost...
[2025-12-11 15:15:25] [INFO] [training] [ModelTrainer]: *** TẠO MÔ HÌNH CUỐI CÙNG: xgboost ***
[2025-12-11 15:15:25] [INFO] [training] [ModelTrainer]: XGBOOST: Price R2=0.7369 | RMSE=$0.79
[2025-12-11 15:15:25] [INFO] [training] [ModelTrainer]: Đang huấn luyện catboost...
[2025-12-11 15:15:25] [INFO] [training] [ModelTrainer]: *** TẠO MÔ HÌNH CUỐI CÙNG: catboost ***
[2025-12-11 15:15:26] [INFO] [training] [ModelTrainer]: CATBOOST: Price R2=0.7587 | RMSE=$0.76
[2025-12-11 15:15:26] [INFO] [training] [ModelTrainer]: Đang huấn luyện lightgbm...
[2025-12-11 15:15:26] [INFO] [training] [ModelTrainer]: *** TẠO MÔ HÌNH CUỐI CÙNG: lightgbm ***
[2025-12-11 15:15:26] [INFO] [training] [ModelTrainer]: LIGHTGBM: Price R2=0.7329 | RMSE=$0.79
[2025-12-11 15:15:27] [INFO] [training] [ModelTrainer]: Đang huấn luyện random_forest...
[2025-12-11 15:15:27] [INFO] [training] [ModelTrainer]: *** TẠO MÔ HÌNH CUỐI CÙNG: random_forest ***
[2025-12-11 15:15:30] [INFO] [training] [ModelTrainer]: RANDOM_FOREST: Price R2=0.7327 | RMSE=$0.79
[2025-12-11 15:15:31] [INFO] [training] [ModelTrainer]: Kết quả lưu tại: results\final_scores.json
[2025-12-11 15:15:31] [INFO] [training] [ModelEvaluator]: >>> KHỞI TẠO MODEL EVALUATOR <<<
[2025-12-11 15:15:52] [INFO] [training] [ModelEvaluator]: Đã lưu biểu đồ: leaderboard.png
[2025-12-11 15:15:52] [INFO] [training] [Main]: 
============================================================
[2025-12-11 15:15:52] [INFO] [training] [Main]: BÁO CÁO TỔNG HỢP HIỆU SUẤT MÔ HÌNH
[2025-12-11 15:15:52] [INFO] [training] [Main]: ============================================================
[2025-12-11 15:15:52] [INFO] [training] [Main]:                  RMSE      R2  Dir_Accuracy
catboost       0.7554  0.7587        0.6667
xgboost        0.7887  0.7369        0.5333
lightgbm       0.7947  0.7329        0.5000
random_forest  0.7950  0.7327        0.5500
[2025-12-11 15:15:52] [INFO] [training] [Main]: MODEL ĐƯỢC CHỌN: CATBOOST
[2025-12-11 15:17:01] [INFO] [training] [ModelEvaluator]: Đã lưu biểu đồ: forecast_catboost.png
[2025-12-11 15:17:08] [INFO] [training] [ModelEvaluator]: Đã lưu biểu đồ: residuals_catboost.png
[2025-12-11 15:17:08] [INFO] [training] [ModelEvaluator]: Đang tính SHAP cho catboost...
[2025-12-11 15:17:13] [INFO] [training] [ModelEvaluator]: Đã lưu biểu đồ: shap_catboost.png
